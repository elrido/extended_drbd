# Generated by Chef for <%= node[:fqdn] %>

global {
  usage-count no;
}
common {
  disk {
    on-io-error detach;
  }
  net {
    <%= node['drbd']['two_masters'] ? 'allow-two-primaries;' : '' %>
    after-sb-0pri <%= node['drbd']['splitbrain']['primary0'] %>;
    after-sb-1pri <%= node['drbd']['splitbrain']['primary1'] %>;
    after-sb-2pri <%= node['drbd']['splitbrain']['primary2'] %>;
  }
  protocol C;
  syncer {
     rate <%= node['drbd']['syncrate']%>;
  }
}
resource <%= @resource %> {
  startup {
    <%= node['drbd']['two_masters'] ? 'become-primary-on both;' : '' %>
  }
  on <%= @my_short_hostname %> {
    device    <%= node['drbd']['dev'] %>;
    disk      <%= node['drbd']['mount'] %>;
    address   <%= @my_ip %>:<%= node['drbd']['port'] %>;
    meta-disk internal;
  }
  on <%= @partner_short_hostname %> {
    device    <%= node['drbd']['dev'] %>;
    disk      <%= node['drbd']['mount'] %>;
    address   <%= @partner_ip %>:<%= node['drbd']['port'] %>;
    meta-disk internal;
  }
}

